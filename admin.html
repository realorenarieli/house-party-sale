<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ניהול המכירה | מכירת עזיבת הארץ</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Password Modal -->
  <div class="modal-overlay" id="passwordModal">
    <div class="modal">
      <h2>🔐 כניסת מנהל</h2>
      <input type="password" id="passwordInput" placeholder="הכנס סיסמה">
      <button class="btn btn-primary" id="passwordSubmit">כניסה</button>
      <p style="margin-top: 15px; font-size: 0.9rem; color: var(--gray);">
        <a href="index.html">חזרה לאתר</a>
      </p>
    </div>
  </div>

  <div id="adminContent" style="display: none;">
    <header class="header admin-header">
      <h1>🔧 ניהול המכירה</h1>
      <p class="subtitle">הוסף, ערוך ומחק פריטים</p>
    </header>

    <div class="banner"></div>

    <div class="admin-container">
      <!-- Analytics Section -->
      <section class="admin-section">
        <h2>📊 סטטיסטיקות</h2>
        <div class="analytics-dashboard" id="analyticsDashboard">
          <div class="analytics-card">
            <h3>סה"כ מבקרים</h3>
            <div class="value highlight" id="totalVisitors">...</div>
          </div>
          <div class="analytics-card">
            <h3>צפיות בדף</h3>
            <div class="value" id="pageViews">0</div>
          </div>
          <div class="analytics-card">
            <h3>לחיצות על פריטים</h3>
            <div class="value" id="totalItemClicks">0</div>
          </div>
          <div class="analytics-card">
            <h3>שפה מועדפת</h3>
            <div class="value" id="preferredLang">-</div>
          </div>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
          <div class="analytics-card">
            <h3>🔥 פריטים פופולריים</h3>
            <div class="analytics-list" id="popularItems">
              <p style="color: var(--gray);">אין נתונים עדיין</p>
            </div>
          </div>
          <div class="analytics-card">
            <h3>📁 קטגוריות פופולריות</h3>
            <div class="analytics-list" id="popularCategories">
              <p style="color: var(--gray);">אין נתונים עדיין</p>
            </div>
          </div>
        </div>

        <button class="btn btn-secondary" onclick="refreshAnalytics()" style="margin-top: 15px;">🔄 רענן נתונים</button>
      </section>

      <!-- Settings Section -->
      <section class="admin-section">
        <h2>⚙️ הגדרות</h2>
        <form id="settingsForm">
          <div class="form-group">
            <label>מספר WhatsApp (עם קידומת מדינה):</label>
            <input type="text" id="settingWhatsapp" placeholder="972501234567">
          </div>
          <div class="form-group">
            <label>תאריך המכירה:</label>
            <input type="text" id="settingDate" placeholder="שבת, 15.02.2026">
          </div>
          <div class="form-group">
            <label>שעות:</label>
            <input type="text" id="settingTime" placeholder="10:00-18:00">
          </div>
          <div class="form-group">
            <label>כתובת:</label>
            <input type="text" id="settingAddress" placeholder="רחוב הדוגמה 123, תל אביב">
          </div>
          <button type="submit" class="btn btn-primary">💾 שמור הגדרות</button>
        </form>
      </section>

      <!-- Add Item Section -->
      <section class="admin-section">
        <h2>➕ הוסף פריט חדש</h2>
        <form id="addItemForm">
          <div class="form-group">
            <label>שם הפריט:</label>
            <input type="text" id="itemName" required placeholder="למשל: ספה תלת מושבית">
          </div>
          <div class="form-group">
            <label>תיאור:</label>
            <textarea id="itemDescription" required placeholder="תאר את הפריט..."></textarea>
          </div>
          <div class="form-group">
            <label>מחיר (₪):</label>
            <input type="number" id="itemPrice" required min="0" placeholder="100">
          </div>
          <div class="form-group">
            <label>קטגוריה:</label>
            <select id="itemCategory" required>
              <!-- Options will be generated by JS -->
            </select>
          </div>
          <div class="form-group">
            <label>מצב:</label>
            <select id="itemCondition" required>
              <option value="new">חדש באריזה</option>
              <option value="likeNew">כמו חדש</option>
              <option value="good" selected>מצב טוב</option>
              <option value="fair">מצב סביר</option>
            </select>
          </div>
          <div class="form-group">
            <label>תמונות (עד 5 תמונות, מקסימום 500KB כל אחת):</label>
            <div class="image-upload-container">
              <input type="file" id="itemImageFiles" accept="image/*" multiple style="margin-bottom: 8px;">
              <div id="itemImagesPreview" class="images-preview"></div>
              <input type="hidden" id="itemImages">
            </div>
          </div>
          <button type="submit" class="btn btn-primary">➕ הוסף פריט</button>
        </form>
      </section>

      <!-- Export Section -->
      <section class="admin-section">
        <h2>📤 שמירת שינויים</h2>
        <p style="margin-bottom: 15px; color: var(--gray);">אחרי שתסיים לערוך, לחץ על אחד הכפתורים כדי לשמור:</p>
        <div class="import-export">
          <button class="btn btn-primary" id="copyJsonBtn">📋 העתק JSON</button>
          <button class="btn btn-secondary" id="exportBtn">📥 הורד קובץ JSON</button>
        </div>
        <p style="margin-top: 15px; font-size: 0.9rem; color: var(--gray);">הדבק את ה-JSON בצ'אט או שלח את הקובץ כדי לעדכן את האתר.</p>
      </section>

      <!-- Items List Section -->
      <section class="admin-section">
        <h2>📦 רשימת פריטים (<span id="itemCount">0</span>)</h2>
        <table class="admin-items-list">
          <thead>
            <tr>
              <th>שם</th>
              <th>קטגוריה</th>
              <th>מחיר</th>
              <th>מצב</th>
              <th>תמונות</th>
              <th>נמכר</th>
              <th>פעולות</th>
            </tr>
          </thead>
          <tbody id="itemsTableBody">
            <!-- Items will be generated by JS -->
          </tbody>
        </table>
      </section>

      <p style="text-align: center; margin: 30px 0;">
        <a href="index.html" class="btn btn-secondary">👁️ צפה באתר</a>
      </p>
    </div>

    <footer class="footer">
      <p>מערכת ניהול מכירת עזיבת הארץ</p>
    </footer>
  </div>

  <!-- Edit Modal -->
  <div class="modal-overlay" id="editModal" style="display: none;">
    <div class="modal" style="max-width: 500px; text-align: right;">
      <h2>✏️ עריכת פריט</h2>
      <form id="editItemForm">
        <input type="hidden" id="editItemId">
        <div class="form-group">
          <label>שם הפריט:</label>
          <input type="text" id="editName" required>
        </div>
        <div class="form-group">
          <label>תיאור:</label>
          <textarea id="editDescription" required></textarea>
        </div>
        <div class="form-group">
          <label>מחיר (₪):</label>
          <input type="number" id="editPrice" required min="0">
        </div>
        <div class="form-group">
          <label>קטגוריה:</label>
          <select id="editCategory" required></select>
        </div>
        <div class="form-group">
          <label>מצב:</label>
          <select id="editCondition" required>
            <option value="new">חדש באריזה</option>
            <option value="likeNew">כמו חדש</option>
            <option value="good">מצב טוב</option>
            <option value="fair">מצב סביר</option>
          </select>
        </div>
        <div class="form-group">
          <label>תמונות (עד 5 תמונות):</label>
          <div class="image-upload-container">
            <input type="file" id="editImageFiles" accept="image/*" multiple style="margin-bottom: 8px;">
            <div id="editImagesPreview" class="images-preview"></div>
            <input type="hidden" id="editImages">
          </div>
        </div>
        <div style="display: flex; gap: 10px; margin-top: 20px;">
          <button type="submit" class="btn btn-primary">💾 שמור</button>
          <button type="button" class="btn btn-secondary" id="cancelEdit">ביטול</button>
        </div>
      </form>
    </div>
  </div>

  <script src="data.js"></script>
  <script src="admin.js"></script>
</body>
</html>
